<!DOCTYPE html>
<html>
<head>
    <title>Bakehub | Checkout</title>
    <link rel="icon" type="image/png" href="bakehub_favicon.png">
    <link rel="stylesheet" href="style.css">
    <style>
        /* styles for Checkout Page */
        .checkout-container {
            max-width: 800px;
            margin: 40px auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            gap: 30px;
        }
        .billing-form { flex: 2; }
        .order-summary { 
            flex: 1; 
            background: #f5eee6; 
            padding: 20px; 
            border-radius: 8px;
            height: fit-content;
        }
        .form-group { margin-bottom: 15px; text-align: left; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input { 
            width: 100%; 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
        }
        .place-order-btn {
            width: 100%;
            padding: 15px;
            background-color: #8b5e3c;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }
        .place-order-btn:hover { background-color: #6f4a2f; }
        .summary-item { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .total-line { 
            border-top: 2px solid #8b5e3c; 
            padding-top: 10px; 
            margin-top: 10px; 
            font-weight: bold; 
            font-size: 1.2em; 
            display: flex; 
            justify-content: space-between;
        }
    </style>
</head>
<body>

<header class="navbar">
    <img src="search.png" height="50">
    <nav class="nav-links">
        <a href="index.html">Back to Menu</a>
        <!-- Temporary ref placements while error persists in index.html-->
        <a href="login.html">Logout</a>
        <a href = "Add_Product.html"> Add Product</a>
    </nav>
</header>

<main class="main-content">
    <h2>Checkout</h2>
    
    <div class="checkout-container">
        <div class="billing-form">
            <h3>Billing Details</h3>
            <form id="checkout-form">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" required placeholder="Titus Rodriguez">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" required placeholder="tituspogi@example.com">
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <input type="text" required placeholder="bahay ni titus">
                </div>
                <button type="submit" class="place-order-btn">Place Order</button>
            </form>
        </div>

        <div class="order-summary">
            <h3>Your Order</h3>
            <div id="summary-items">
                </div>
            <div class="total-line">
                <span>Total</span>
                <span id="summary-total">0.00</span>
            </div>
        </div>
    </div>
</main>

<script>
    // Master product list — single source of truth for prices
    const STATIC_PRODUCTS = [
        { name: "Chocolate Cake",        price: 100.00 },
        { name: "Croissant",             price: 40.00  },
        { name: "Blueberry Muffin",      price: 50.00  },
        { name: "Chocolate Chip Cookie", price: 80.00   },
        { name: "Red Velvet Cupcake",    price: 85.00  }
    ];

    function getMasterPrices() {
        const map = {};
        STATIC_PRODUCTS.forEach(p => { map[p.name] = p.price; });
        // Merge seller-added products
        const sellerProducts = JSON.parse(localStorage.getItem('bakehubSellerProducts') || '[]');
        sellerProducts.forEach(p => { map[p.name] = parseFloat(p.price); });
        return map;
    }

    //load the Cart Data
    document.addEventListener('DOMContentLoaded', () => {
        const session = JSON.parse(localStorage.getItem('bakehubSession') || 'null');
        const cartKey = session ? 'bakehubCart_' + session.username : 'bakehubCart_guest';
        const savedCart = localStorage.getItem(cartKey);
        const summaryContainer = document.getElementById('summary-items');
        const totalElement = document.getElementById('summary-total');
        
        if (savedCart) {
            const cart = JSON.parse(savedCart);
            const masterPrices = getMasterPrices();
            let total = 0;

            cart.forEach(item => {
                // Always use current price from master list; fall back to saved price if not found
                const currentPrice = masterPrices[item.name] !== undefined
                    ? masterPrices[item.name]
                    : item.price;
                const itemTotal = currentPrice * item.quantity;
                total += itemTotal;

                summaryContainer.innerHTML += `
                    <div class="summary-item">
                        <span>${item.quantity}x ${item.name}</span>
                        <span>&#8369;${itemTotal.toFixed(2)}</span>
                    </div>
                `;
            });
            
            totalElement.textContent = "₱" + total.toFixed(2);
        }
    });

    // Fake "Place Order" Action
    document.getElementById('checkout-form').addEventListener('submit', (e) => {
        e.preventDefault();
        alert('Thank you for your order! Your pastries are on the way.');
        const session = JSON.parse(localStorage.getItem('bakehubSession') || 'null');
        const cartKey = session ? 'bakehubCart_' + session.username : 'bakehubCart_guest';
        localStorage.removeItem(cartKey); // Clear cart
        window.location.href = 'index.html'; // Go back home
    });
</script>

<footer class="footer">
    <p>CCAPDEV S12 Team Gardenia </p>
</footer>

</body>
</html>